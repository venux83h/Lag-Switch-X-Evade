-- SERVICES
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")

-- GLOBALS
getgenv().lagDuration = 1
local isLagActive = false

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "LagUI"
gui.ResetOnSpawn = false
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
gui.Parent = CoreGui

local button = Instance.new("TextButton")
button.Size = UDim2.fromOffset(70, 70)
button.Position = UDim2.fromScale(0.1, 0.5)
button.AnchorPoint = Vector2.new(0.5, 0.5)
button.Text = "Lag"
button.Font = Enum.Font.GothamBold
button.TextSize = 16
button.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
button.BackgroundTransparency = 0.9
button.TextColor3 = Color3.fromRGB(0, 0, 0)
button.AutoButtonColor = false
button.Active = true
button.ZIndex = 10
button.Parent = gui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(1, 0)
corner.Parent = button

-- BLACK OUTLINE
local stroke = Instance.new("UIStroke")
stroke.Color = Color3.fromRGB(0, 0, 0)
stroke.Thickness = 3
stroke.Transparency = 0.2
stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
stroke.LineJoinMode = Enum.LineJoinMode.Round
stroke.Parent = button

-- OFFICIAL ROBLOX NOTIFICATION
local function showNotice(text)
	pcall(function()
		StarterGui:SetCore("SendNotification", {
			Title = "Lag UI",
			Text = text,
			Duration = 3
		})
	end)
end

-- STATE
local dragging = false
local dragInput
local dragStart
local startPos
local locked = false

-- HOLD LOGIC
local HOLD_TIME = 1
local holdToken = 0
local longPressTriggered = false

button.InputBegan:Connect(function(input)
	if input.UserInputType ~= Enum.UserInputType.MouseButton1
	and input.UserInputType ~= Enum.UserInputType.Touch then
		return
	end

	longPressTriggered = false
	holdToken += 1
	local token = holdToken

	dragInput = input

	if not locked then
		dragging = true
		dragStart = input.Position
		startPos = button.Position
	end

	task.delay(HOLD_TIME, function()
		if holdToken ~= token then return end
		if dragInput ~= input then return end

		locked = not locked
		longPressTriggered = true
		showNotice(locked and "Button Locked" or "Button Unlocked")
	end)
end)

button.InputEnded:Connect(function(input)
	if input == dragInput then
		dragging = false
		dragInput = nil
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if dragging and input == dragInput and not locked then
		local delta = input.Position - dragStart
		button.Position = UDim2.new(
			startPos.X.Scale,
			startPos.X.Offset + delta.X,
			startPos.Y.Scale,
			startPos.Y.Offset + delta.Y
		)
	end
end)

-- LAG FREEZE
local function lagFreeze()
	if longPressTriggered then return end
	if isLagActive then return end

	isLagActive = true
	button.Text = "•••"

	local start = tick()
	while tick() - start < getgenv().lagDuration do
		local a = math.random(1, 1e6) * math.random(1, 1e6)
		a = a / math.random(1, 1e4)
	end

	button.Text = "Lag"
	isLagActive = false
end

button.MouseButton1Click:Connect(lagFreeze)
